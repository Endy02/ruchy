import React, { useState, useRef, useEffect } from 'react'
import TeamSelector from '../pages/simulator/TeamSelector'

const GameSimulator = ({teams}) => {
    const [isOpen, setIsOpen] = useState(false)
    const [identifier, setIdentifier] = useState('')
    const [homeTeam, setHomeTeam] = useState({})
    const [awayTeam, setAwayteam] = useState({})
    const [errors, setErrors] = useState({})
    const HomeDefault = "/assets/images/teams/chicago-bulls.svg"
    const AwayDefault = "/assets/images/teams/boston-celtics.svg"
    const status = 1

    const openModal = (identifier) => {
        setIsOpen(true)
        setIdentifier(Capitalize(identifier))
    }

    const SelectTeam = (team) => {
        if(identifier){
            if(identifier == 'Home'){
                setHomeTeam(team)
                checkTeam()
                setIsOpen(false)
            }else if(identifier == 'Away'){
                setAwayteam(team)
                checkTeam()
                setIsOpen(false)
            }
        }
    }

    const Capitalize = (str) => {
        if(str){
            return str.charAt(0).toUpperCase() + str.slice(1);
        }
    }

    const checkTeam = () => {
        if(homeTeam.name == awayTeam.name){
            setErrors({
                'title': 'Team selection error',
                'message': 'You cannot select the same team match up'
            })
        }else if(homeTeam && awayTeam){
            
        }
    }

    const CloseModal = () => {
        setIsOpen(false)
    }

    const TeamModal = () => {
        return(
            <>
                <div className='modal-wrapper'>
                    <div className='modal-overlay'>
                        <div className='modal'>
                            <div className='flex-row-end full-width'>
                                <div className='modal-close' onClick={CloseModal}>
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
                                        <path d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/>
                                    </svg>
                                </div>
                            </div>
                            <div className='modal-content'>
                                <div className='modal-title'>
                                    <h2 className='big-text bold-text black-text pad-b-s'>Select the {identifier ? identifier : ''} team</h2>
                                </div>
                                <div className='modal-content-inner'>
                                    <TeamSelector selectTeam={SelectTeam}/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </>
        )
    }

    return (
        <>
            <div className='sim-container'>
                <div className='sim-selector sim-left' onClick={() => openModal('away')}>
                    <div className='sim-selctor-inner'>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 284 284">
                            <defs>
                                <filter id="Subtraction_4" x="0" y="0" filterUnits="userSpaceOnUse">
                                <feOffset dx="3" input="SourceAlpha"/>
                                <feGaussianBlur stdDeviation="3" result="blur"/>
                                <feFlood floodOpacity="0.161"/>
                                <feComposite operator="in" in2="blur"/>
                                <feComposite in="SourceGraphic"/>
                                </filter>
                            </defs>
                            <g transform="matrix(1, 0, 0, 1, 0, 0)" filter="url(#Subtraction_4)">
                                <g id="team-selector" data-name="Subtraction 4" transform="translate(-77 -74)" fill="#fff">
                                <path d="M 333.9999084472656 346.0002746582031 L 98.0001220703125 346.0002746582031 C 94.79473114013672 346.0002746582031 91.78119659423828 344.7520141601562 89.51462554931641 342.4854125976562 C 87.24801635742188 340.2189025878906 85.99976348876953 337.2053833007812 85.99976348876953 333.9999084472656 L 85.99976348876953 168.9483489990234 C 107.8137664794922 168.202392578125 128.2335815429688 159.3331604003906 143.7834777832031 143.7832336425781 C 159.3337249755859 128.2329864501953 168.202880859375 107.813362121582 168.9483795166016 85.99976348876953 L 333.9999084472656 85.99980163574219 C 337.205322265625 85.99980163574219 340.2188720703125 87.24805450439453 342.4854125976562 89.51462554931641 C 344.7520141601562 91.78119659423828 346.0002746582031 94.79476165771484 346.0002746582031 98.0001220703125 L 346.0002746582031 333.9999084472656 C 346.0002746582031 337.2052917480469 344.7520141601562 340.2188415527344 342.4854125976562 342.4854125976562 C 340.2188720703125 344.7520141601562 337.205322265625 346.0002746582031 333.9999084472656 346.0002746582031 Z" stroke="none"/>
                                <path d="M 333.9999084472656 343.000244140625 C 336.4040222167969 343.000244140625 338.6641235351562 342.0640563964844 340.3641357421875 340.364013671875 C 342.0640563964844 338.6641235351562 343.000244140625 336.4039916992188 343.000244140625 333.9999084472656 L 343.000244140625 98.00012969970703 C 343.000244140625 95.59609222412109 342.0640258789062 93.33589935302734 340.364013671875 91.6358642578125 C 338.6641540527344 89.93597412109375 336.4040222167969 88.99982452392578 333.9999084472656 88.99982452392578 L 171.8011169433594 88.99978637695312 C 170.3751525878906 110.4823913574219 161.3067169189453 130.5026245117188 145.9048156738281 145.9045562744141 C 130.5032043457031 161.3061370849609 110.4827117919922 170.3746490478516 88.99978637695312 171.8010406494141 L 88.99978637695312 333.9999084472656 C 88.99978637695312 336.4040222167969 89.93593597412109 338.6641540527344 91.63594055175781 340.3641052246094 C 93.33586120605469 342.0640563964844 95.59605407714844 343.000244140625 98.00012969970703 343.000244140625 L 333.9999084472656 343.000244140625 M 333.9999084472656 349.000244140625 L 98.00012969970703 349.000244140625 C 93.99340057373047 349.000244140625 90.2264404296875 347.4399108886719 87.39328765869141 344.6067199707031 C 84.56008911132812 341.7736206054688 82.99978637695312 338.0066833496094 82.99978637695312 333.9999084472656 L 82.99978637695312 165.9996337890625 C 105.1349411010742 165.9991302490234 125.9679412841797 157.3561248779297 141.6621704101562 141.6618957519531 C 157.3563995361328 125.9676666259766 165.9995880126953 105.1344375610352 165.9995880126953 82.99978637695312 L 333.9999084472656 82.99982452392578 C 338.0066833496094 82.99982452392578 341.7735900878906 84.56008911132812 344.6067199707031 87.39328765869141 C 347.4399108886719 90.22647857666016 349.000244140625 93.99340057373047 349.000244140625 98.00012969970703 L 349.000244140625 333.9999084472656 C 349.000244140625 338.0066833496094 347.4399108886719 341.7735900878906 344.6067199707031 344.6067199707031 C 341.7736206054688 347.4399108886719 338.0067138671875 349.000244140625 333.9999084472656 349.000244140625 Z" stroke="none" fill="#f65d19"/>
                                </g>
                            </g>
                        </svg>
                        <img src={Object.keys(awayTeam).length === 0 ? AwayDefault : awayTeam.url} className="sim-selector-img"/>
                    </div>
                </div>
                <div className='play-btn' onClick={() => teams(homeTeam, awayTeam, status)}>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 122 122">
                        <defs>
                            <filter id="play_icon" x="41" y="20" filterUnits="userSpaceOnUse">
                            <feOffset dx="3" dy="3" input="SourceAlpha"/>
                            <feGaussianBlur stdDeviation="3" result="blur"/>
                            <feFlood floodOpacity="0.161"/>
                            <feComposite operator="in" in2="blur"/>
                            <feComposite in="SourceGraphic"/>
                            </filter>
                        </defs>
                        <g id="play_button" transform="translate(-345 -2896)">
                            <circle id="play_back" cx="61" cy="61" r="61" transform="translate(345 2896)" fill="#f65d19"/>
                            <g transform="matrix(1, 0, 0, 1, 345, 2896)" filter="url(#play_icon)">
                            <path id="play_icon-2" data-name="play_icon" d="M31.87,3.935a4,4,0,0,1,6.261,0L64.837,37.51A4,4,0,0,1,61.707,44H8.293a4,4,0,0,1-3.13-6.49Z" transform="translate(91 26) rotate(90)" fill="#fff"/>
                            </g>
                        </g>
                    </svg>
                </div>
                <div className='sim-selector sim-rigth' onClick={() => openModal('home')}>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 284 284.001">
                        <defs>
                            <filter id="Subtraction_5" x="0" y="0" filterUnits="userSpaceOnUse">
                            <feOffset dy="3" input="SourceAlpha"/>
                            <feGaussianBlur stdDeviation="3" result="blur"/>
                            <feFlood floodOpacity="0.161"/>
                            <feComposite operator="in" in2="blur"/>
                            <feComposite in="SourceGraphic"/>
                            </filter>
                        </defs>
                        <g transform="matrix(1, 0, 0, 1, 0, 0)" filter="url(#Subtraction_5)">
                            <g id="team-selector" data-name="Subtraction 5" transform="translate(9 6)" fill="#fff">
                            <path d="M 180.0509033203125 263.0004272460938 L 15.00030517578125 263.0004272460938 C 11.79487705230713 263.0004272460938 8.781341552734375 261.7521667480469 6.514805316925049 259.4856262207031 C 4.248269557952881 257.2190856933594 3.000019788742065 254.2055206298828 3.000019788742065 251.0000915527344 L 3.000019788742065 15.00030899047852 C 3.000019788742065 11.79488086700439 4.248269557952881 8.781309127807617 6.514805316925049 6.514773368835449 C 8.781341552734375 4.248237609863281 11.79487705230713 2.999987602233887 15.00030517578125 2.999987602233887 L 251.0000915527344 2.999987602233887 C 254.2054901123047 2.999987602233887 257.2190551757812 4.248237609863281 259.4856262207031 6.514773368835449 C 261.7521667480469 8.781344413757324 263.0004272460938 11.7949161529541 263.0004272460938 15.00030899047852 L 263.0004272460938 180.0509796142578 C 241.1862030029297 180.7969512939453 220.7661285400391 189.6662750244141 205.2160949707031 205.21630859375 C 189.6656799316406 220.7667236328125 180.7964019775391 241.1866149902344 180.0509033203125 263.0004272460938 Z" stroke="none"/>
                            <path d="M 177.1981048583984 260.0013732910156 C 178.6240844726562 238.5185699462891 187.6926727294922 218.4970703125 203.0947418212891 203.094970703125 C 218.4964904785156 187.6932525634766 238.5172424316406 178.6246795654297 260.0003967285156 177.1982879638672 L 260.0003967285156 15.00031757354736 C 260.0003967285156 12.59620189666748 259.064208984375 10.33600997924805 257.3642883300781 8.636124610900879 C 255.6643981933594 6.936202049255371 253.4042053222656 6.000009536743164 251.0000762939453 6.000009536743164 L 15.0003137588501 6.000009536743164 C 12.59619808197021 6.000009536743164 10.33600616455078 6.936202049255371 8.63612174987793 8.636124610900879 C 6.936198234558105 10.33600997924805 6.000006198883057 12.59620189666748 6.000006198883057 15.00031757354736 L 6.000006198883057 251.0001220703125 C 6.000006198883057 253.4042053222656 6.936198234558105 255.6643981933594 8.63612174987793 257.3642883300781 C 10.33600616455078 259.064208984375 12.59619808197021 260.0003967285156 15.00035190582275 260.0003967285156 L 177.1981048583984 260.0013732910156 M 182.9996948242188 266.0014038085938 L 182.9996948242188 266.0003967285156 L 15.0003137588501 266.0003967285156 C 10.99354457855225 266.0003967285156 7.226621627807617 264.4400939941406 4.393467426300049 261.60693359375 C 1.560313701629639 258.7737731933594 6.056565325707197e-06 255.0068511962891 6.056565325707197e-06 251.0001220703125 L 6.056565325707197e-06 15.00031757354736 C 6.056565325707197e-06 10.99354839324951 1.560313701629639 7.226624965667725 4.393467426300049 4.393471240997314 C 7.226621627807617 1.560317277908325 10.99354457855225 9.596604286343791e-06 15.0003137588501 9.596604286343791e-06 L 251.0000762939453 9.596604286343791e-06 C 255.0068511962891 9.596604286343791e-06 258.7737731933594 1.560317277908325 261.60693359375 4.393471240997314 C 264.4400939941406 7.226624965667725 266.0003967285156 10.99354839324951 266.0003967285156 15.00031757354736 L 266.0003967285156 182.9996948242188 C 243.8650512695312 183.0001983642578 223.0318145751953 191.6432342529297 207.3373870849609 207.3376312255859 C 191.6430053710938 223.0320434570312 182.9996948242188 243.8655548095703 182.9996948242188 266.0003967285156 L 182.9996948242188 266.0014038085938 Z" stroke="none" fill="#f65d19"/>
                            </g>
                        </g>
                    </svg>
                    <img src={Object.keys(homeTeam).length === 0 ? HomeDefault : homeTeam.url} className="sim-selector-img"/>
                </div>
            </div>
            {isOpen ? <TeamModal/>: ''}
        </>
    )
}

export default GameSimulator